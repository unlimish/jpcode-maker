<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>カスタマーコード宛名ラベルメーカー</title>

	<script src="https://cdn.tailwindcss.com"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/bwip-js/3.0.4/bwip-js-min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

	<style>
		/* Tailwindでカバーしきれない細部の調整やフォント指定 */
		body {
			font-family: 'Noto Sans JP', sans-serif;
		}
	</style>
</head>

<body class="bg-gradient-to-b from-red-950 to-stone-950 text-white p-6 min-h-screen">

	<div class="max-w-6xl mx-auto">

		<header class="mb-8 text-center sm:text-left border-b border-gray-200 pb-4">
			<h1 class="text-2xl font-bold">カスタマーコード宛名ラベルメーカー</h1>
			<!-- <p class="text-sm text-gray-500 mt-1">カスタマーバーコード付きの宛名ラベルを作成します</p> -->
		</header>

		<div class="flex grid grid-cols-1 lg:flex gap-8">

			<div class="w-3xs bg-black p-6 rounded-lg shadow-sm border border-gray-100 h-full">
				<h2 class="text-lg font-semibold mb-4 text-gray-300 flex items-center">
					<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
							d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
						</path>
					</svg>
					情報の入力
				</h2>

				<div class="space-y-4 ">
					<div class="">
						<label class="block text-sm font-medium text-gray-300 mb-1">郵便番号<span class="text-xs text-gray-400">
								ハイフンなし</span></label>
						<input type="text" id="inputPost" placeholder="1000001" value="1000001"
							class="w-full px-4 py-2 bg-gray-800 border border-gray-800 rounded-md focus:ring-2 focus:ring-red-800 focus:border-red-800 outline-none transition-colors">
					</div>
					<div>
						<label class="block text-sm font-medium text-gray-300 mb-1">住所 <span
								class="text-xs text-gray-400">(番地・部屋番号まで)</span></label>
						<input type="text" id="inputAddr" placeholder="東京都千代田区千代田1-1" value="東京都千代田区千代田1-1"
							class="w-full px-4 py-2 bg-gray-800 border border-gray-800 rounded-md focus:ring-2 focus:ring-red-800 focus:border-red-800 outline-none transition-colors">
					</div>
					<div>
						<label class="block text-sm font-medium text-gray-300 mb-1">宛名</label>
						<input type="text" id="inputName" placeholder="日本 太郎 様" value="日本 太郎 様"
							class="w-full px-4 py-2 bg-gray-800 border border-gray-800 rounded-md focus:ring-2 focus:ring-red-800 focus:border-red-800 outline-none transition-colors">
					</div>

					<button onclick="generatePreview()"
						class="w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-4 rounded-md transition duration-200 mt-2">
						プレビューを更新
					</button>
				</div>
			</div>

			<div class="flex flex-col items-center">
				<div class="w-full flex justify-between items-center mb-4">
					<h2 class="text-lg font-semibold text-gray-300 flex items-center">
						<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
								d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
								d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
							</path>
						</svg>
						プレビュー
					</h2>
					<button onclick="downloadImage()"
						class="text-sm hover:bg-red-900 text-white py-1 px-3 rounded flex items-center transition-colors">
						<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
								d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
						</svg>
						PNG保存
					</button>
				</div>

				<div id="preview-wrapper"
					class="w-full overflow-auto bg-gray-200 p-4 rounded border border-gray-300 flex justify-center">
					<div id="preview-area" class="bg-white relative shadow-lg box-border flex flex-col justify-between"
						style="width: 600px; height: 350px; padding: 40px;">

						<div class="text-left">
							<div id="dispPost" class="text-xl tracking-widest font-medium mb-2 font-mono">〒100-0001</div>
							<div id="dispAddr" class="text-lg leading-relaxed">東京都千代田区千代田1-1</div>
						</div>

						<div id="dispName" class="text-4xl font-bold text-center my-4">日本 太郎 様</div>

						<div class="text-left mt-2">
							<canvas id="barcodeCanvas"></canvas>
						</div>
					</div>
				</div>
				<p class="text-xs text-gray-400 mt-2">※ 画像サイズ: 600px x 350px</p>
			</div>
		</div>
	</div>

	<script>
		function cleanAddressForBarcode(zip, address) {
			let clean = address.replace(/[Ａ-Ｚａ-ｚ０-９－]/g, function (s) {
				return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
			});
			const firstDigit = clean.search(/[0-9]/);
			if (firstDigit !== -1) {
				clean = clean.substring(firstDigit);
			} else {
				clean = "";
			}
			return zip.replace(/-/g, '') + clean;
		}

		function generatePreview() {
			const post = document.getElementById('inputPost').value;
			const addr = document.getElementById('inputAddr').value;
			const name = document.getElementById('inputName').value;

			document.getElementById('dispPost').innerText = "〒" + post;
			document.getElementById('dispAddr').innerText = addr;
			document.getElementById('dispName').innerText = name;

			const barcodeData = cleanAddressForBarcode(post, addr);

			try {
				bwipjs.toCanvas('barcodeCanvas', {
					bcid: 'japanpost',
					text: barcodeData,
					scale: 2,
					height: 4,
					incltext: false,
					backgroundcolor: 'FFFFFF',
				});
			} catch (e) {
				console.error("Barcode Error:", e);
			}
		}

		function downloadImage() {
			const element = document.getElementById('preview-area');
			html2canvas(element, { scale: 2 }).then(canvas => { // scale:2 で高画質化
				const link = document.createElement('a');
				link.download = 'address_label.png';
				link.href = canvas.toDataURL('image/png');
				link.click();
			});
		}

		window.onload = generatePreview;
	</script>
</body>

</html>
